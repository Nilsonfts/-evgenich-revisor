# help_system_new.py
"""
Полностью переработанная система справки с четкими инструкциями
"""

from datetime import datetime
from roles import get_available_roles_for_day, UserRole

class HelpSystem:
    """Система справки для бота с поддержкой ролей."""
    
    @staticmethod
    def get_user_help() -> str:
        """Возвращает понятную справку для обычных пользователей."""
        day_of_week = datetime.now().weekday()
        available_roles = get_available_roles_for_day(day_of_week)
        
        # Определяем тип дня
        is_weekend = day_of_week in [4, 5]  # Пятница и суббота
        day_name = ["понедельник", "вторник", "среда", "четверг", "пятница", "суббота", "воскресенье"][day_of_week]
        
        help_text = f"""
📘 **СПРАВКА ДЛЯ ВЕДУЩИХ** 📘

📅 **Сегодня: {day_name.upper()}**
"""
        
        if is_weekend:
            help_text += """
🎉 **ВЫХОДНОЙ ДЕНЬ (ПТ-СБ) - 2 ВЕДУЩИХ РАБОТАЮТ ВМЕСТЕ!**

🎤 **КАРАОКЕ ВЕДУЩИЙ** - главный ведущий
   • Ведет караоке программу
   • Объявляет песни и исполнителей  
   • Цель: 15 голосовых сообщений за смену

🎭 **МС (АНИМАТОР)** - помощник-ведущий
   • Проводит игры и конкурсы
   • Развлекает гостей между песнями
   • Цель: 10 голосовых сообщений за смену

💡 **КАК НАЧАТЬ РАБОТУ:**
• `/start` - займет первую свободную роль
• `/start караоке` - стать караоке ведущим  
• `/start МС` - стать МС аниматором

⚠️ **ВАЖНО:** В выходные работают ОБА ведущих одновременно!
"""
        else:
            help_text += """
🎤 **РАБОЧИЙ ДЕНЬ (ВС-ЧТ) - 1 ВЕДУЩИЙ**

🎤 **КАРАОКЕ ВЕДУЩИЙ** - единственная роль
   • Ведет всю программу самостоятельно
   • Цель: 15 голосовых сообщений за смену

💡 **КАК НАЧАТЬ РАБОТУ:**
• `/start` - начать смену
"""
        
        help_text += """

🎯 **ОСНОВНЫЕ КОМАНДЫ:**

📊 **ОТЧЕТЫ И СТАТИСТИКА:**
• `/check` или `/промежуточный` - мой отчет по смене
• `/сводка` - общая статистика за все время

🔄 **ПЕРЕДАЧА СМЕНЫ:**
• `/передать` - передать смену (ответьте на сообщение)

☕️ **ПЕРЕРЫВЫ:**
Просто напишите: `перерыв`, `обед`, `покурить`, `отдых`, `кофе`, `устал`, `отойду`, `туалет`, `передохнуть`, `размяться`, `звонок`

✅ **ВОЗВРАЩЕНИЕ С ПЕРЕРЫВА:**
Напишите: `вернулся`, `готов`, `работаю`, `на месте`, `поехали`, `включился`, `в деле`, `отдохнул`, `все`
💡 *Или просто запишите голосовое - это автоматически засчитается как возвращение*

🎤 **ГОЛОСОВЫЕ СООБЩЕНИЯ:**
• Отправляйте голосовые - они автоматически считаются
• Распознаются рекламные фразы
• Ведется подробная статистика

📋 **ДОПОЛНИТЕЛЬНЫЕ КОМАНДЫ:**
• `/help` - эта справка
• `/commands` или `/команды` - полный список всех команд
• `/quick` или `/быстрые` - быстрые команды
• `/роли` - информация о ролях и расписании
• `/ads` - просмотр рекламных шаблонов
• `/time` - показать текущее время
• `/rating` - рейтинг всех ведущих
• `/status` - статус системы
• `/старт` - аналог /start (русская версия)
• `/стартmc` - начать как МС аниматор (в выходные)

💪 **УДАЧНОЙ СМЕНЫ!**
"""
        
        return help_text
    
    @staticmethod
    def get_admin_help() -> str:
        """Возвращает справку для администраторов."""
        return """
⚜️ **СПРАВКА ДЛЯ АДМИНИСТРАТОРОВ** ⚜️

🛠️ **ПЕРВОНАЧАЛЬНАЯ НАСТРОЙКА:**
• `/setup_wizard` - мастер настройки чата (город, часовой пояс, график, концепция)

🎛️ **ИНТЕРАКТИВНАЯ ПАНЕЛЬ:**
• `/admin` - открыть админ-панель с кнопками
• Удобное управление через меню вместо команд

🔧 **УПРАВЛЕНИЕ БОТОМ:**
• `/bot_off` или `/выключить` - выключить бота в чате
• `/bot_on` или `/включить` - включить бота в чате  
• `/bot_status` - проверить статус бота
• `/problems` - диагностика ошибок системы

🎭 **УПРАВЛЕНИЕ РОЛЯМИ:**
• `/роли` - информация о текущем расписании ролей
• Через админ-панель: настройка ролей для каждого дня недели
• Установка целей для разных ролей

📊 **ОТЧЕТЫ И АНАЛИТИКА:**
• `/admin` → "📊 Статус" - общая статистика смен
• `/admin` → "📈 Рейтинг" - рейтинг ведущих
• `/admin` → "📝 Отчет" - подробные отчеты
• `/report` - прямой доступ к отчетам
• `/rating` - рейтинг ведущих (текстом)
• `/status` - статус системы

🛠️ **ТЕХНИЧЕСКОЕ УПРАВЛЕНИЕ:**
• `/admin` → "🔄 Рестарт" - перезапуск системы смен
• `/admin` → "📜 Лог" - просмотр логов событий
• `/admin` → "🚨 Проблемы" - диагностика ошибок
• `/log` - прямой доступ к логам
• `/debug_config` - отладка конфигурации

🌟 **ФУНКЦИИ BOSS (только для BOSS_ID):**
• `/admin` → "📢 Рассылка" - отправка сообщений во все чаты
• Полный доступ ко всем функциям

🔒 **БЕЗОПАСНОСТЬ:**
• Админ-панель видят только администраторы чата
• Автоматическая проверка прав доступа
• Логирование всех административных действий

📋 **СИСТЕМНАЯ ИНФОРМАЦИЯ:**

🗓️ **РАСПИСАНИЕ РОЛЕЙ ПО УМОЛЧАНИЮ:**
• Воскресенье-четверг: 1 караоке ведущий (цель: 15)
• Пятница-суббота: 2 ведущих - караоке (15) + МС (10)

💾 **БАЗА ДАННЫХ:**
• SQLite для быстрого доступа к данным
• Автоматическая очистка старых записей (30+ дней)
• Резервирование в Google Таблицы

🔄 **АВТОМАТИЗАЦИЯ:**
• Ежедневная очистка в 03:00
• Автоматическое назначение ролей по расписанию
• Интеграция с Google Sheets

⚡ **БЫСТРЫЕ КОМАНДЫ:**
• `/adminhelp` - эта справка (исправлено)
• `/restart_bot` - быстрый рестарт
• `/stats_all` - полная статистика
• `/time` - показать текущее время
• `/ads` - управление рекламными шаблонами

🎯 **ИСПОЛЬЗОВАНИЕ ПАНЕЛИ:**
1. Отправьте `/admin`
2. Нажимайте кнопки для управления
3. Меню автоматически скрывается от обычных пользователей

💡 **СОВЕТ:** Используйте интерактивную панель вместо команд - это удобнее и безопаснее!
"""
    
    @staticmethod
    def get_roles_info() -> str:
        """Возвращает информацию о системе ролей."""
        day_of_week = datetime.now().weekday()
        day_names = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"]
        current_day = day_names[day_of_week]
        
        return f"""
🎭 **СИСТЕМА РОЛЕЙ БОТА** 🎭

📅 **СЕГОДНЯ: {current_day}**

🗓️ **РАСПИСАНИЕ ПО ДНЯМ НЕДЕЛИ:**

🔹 **РАБОЧИЕ ДНИ (Вс-Чт):**
   🎤 1 КАРАОКЕ ВЕДУЩИЙ
   • Цель: 15 голосовых сообщений
   • Ведет всю программу

🔸 **ВЫХОДНЫЕ ДНИ (Пт-Сб):**
   🎤 КАРАОКЕ ВЕДУЩИЙ - цель: 15 голосовых
   🎭 МС АНИМАТОР - цель: 10 голосовых
   • Работают параллельно!

🎯 **РОЛИ И ИХ ФУНКЦИИ:**

🎤 **КАРАОКЕ ВЕДУЩИЙ**
   • Основной ведущий программы
   • Объявляет исполнителей и песни
   • Взаимодействует с публикой
   • Контролирует очередь исполнителей

🎭 **МС (ВЕДУЩИЙ-АНИМАТОР)**
   • Развлекает публику между песнями
   • Проводит игры и конкурсы
   • Помогает создать атмосферу
   • Работает в команде с караоке ведущим

⚙️ **АВТОМАТИЧЕСКОЕ НАЗНАЧЕНИЕ:**
• Бот сам определяет доступные роли по дню недели
• В рабочие дни - только караоке ведущий
• В выходные - можно выбрать роль или занять свободную

💡 **КОМАНДЫ С РОЛЯМИ:**
• `/start` - автоматическое назначение
• `/start караоке` - конкретная роль караоке ведущего  
• `/start МС` - конкретная роль МС аниматора

📊 **РАЗДЕЛЬНАЯ ОТЧЕТНОСТЬ:**
• Каждая роль имеет свою статистику
• Отдельные цели и показатели
• Независимые отчеты в Google Таблицы
"""

# Функции для обработчиков
def get_help_text() -> str:
    """Быстрая функция для получения пользовательской справки."""
    return HelpSystem.get_user_help()

def get_admin_help_text() -> str:
    """Быстрая функция для получения админской справки."""
    return HelpSystem.get_admin_help()

def get_roles_help_text() -> str:
    """Быстрая функция для получения информации о ролях."""
    return HelpSystem.get_roles_info()
