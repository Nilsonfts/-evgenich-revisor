# help_system.py
"""
–°–∏—Å—Ç–µ–º–∞ –ø–æ–º–æ—â–∏ –¥–ª—è –±–æ—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–æ–ª–µ–π
"""

from telebot import types
from roles import UserRole, ROLE_EMOJIS, ROLE_DESCRIPTIONS, get_current_day_type, get_roles_for_day_type
from utils import is_admin, get_username
from config import BOSS_ID

def get_user_help_text() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø–æ–º–æ—â–∏ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    current_day_type = get_current_day_type()
    available_roles = get_roles_for_day_type(current_day_type)
    
    help_lines = [
        "üìò **–°–ü–†–ê–í–ö–ê –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô** üìò",
        "",
        f"üìÖ **–°–µ–≥–æ–¥–Ω—è: {current_day_type.value} –¥–µ–Ω—å**",
        f"üé≠ **–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–æ–ª–∏:**"
    ]
    
    for role in available_roles:
        emoji = ROLE_EMOJIS.get(role, "üë§")
        description = ROLE_DESCRIPTIONS.get(role, role)
        help_lines.append(f"   {emoji} {description}")
    
    help_lines.extend([
        "",
        "üéØ **–û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´:**",
        "",
        "`/start` –∏–ª–∏ `/—Å—Ç–∞—Ä—Ç`",
        "üé¨ –ó–∞–Ω—è—Ç—å —Å–º–µ–Ω—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Ä–æ–ª—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)",
        "",
        "`/start –∫–∞—Ä–∞–æ–∫–µ` –∏–ª–∏ `/start –ú–°`", 
        "üé≠ –ó–∞–Ω—è—Ç—å —Å–º–µ–Ω—É —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–æ–ª—å—é (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)",
        "",
        "`/–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π` –∏–ª–∏ `/check`",
        "üìä –ü–æ–∫–∞–∑–∞—Ç—å –ª–∏—á–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —Ç–µ–∫—É—â–µ–π —Å–º–µ–Ω–µ",
        "",
        "`/—Å–≤–æ–¥–∫–∞`",
        "üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã",
        "",
        "`/–ø–µ—Ä–µ–¥–∞—Ç—å`",
        "üîÑ –ü–µ—Ä–µ–¥–∞—Ç—å —Å–º–µ–Ω—É –¥—Ä—É–≥–æ–º—É (–æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ)",
        "",
        "‚òïÔ∏è **–ü–ï–†–ï–†–´–í–´:**",
        "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ: `–ø–µ—Ä–µ—Ä—ã–≤`, `–æ–±–µ–¥`, `–æ—Ç–¥—ã—Ö`, `–ø–æ–∫—É—Ä–∏—Ç—å`",
        "",
        "‚úÖ **–í–û–ó–í–†–ê–©–ï–ù–ò–ï:**",
        "–ù–∞–ø–∏—à–∏—Ç–µ: `–≤–µ—Ä–Ω—É–ª—Å—è`, `–Ω–∞ –º–µ—Å—Ç–µ`, `–≥–æ—Ç–æ–≤`",
        "",
        "üé§ **–ì–û–õ–û–°–û–í–´–ï –°–û–û–ë–©–ï–ù–ò–Ø:**",
        "–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
        "",
        "‚ùì **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ü–û–ú–û–©–¨:**",
        "`/help` - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É",
        "`/—Ä–æ–ª–∏` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–æ–ª—è—Ö –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏"
    ])
    
    return "\n".join(help_lines)

def get_admin_help_text(user_id: int) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø–æ–º–æ—â–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤"""
    help_lines = [
        "üõ†Ô∏è **–°–ü–†–ê–í–ö–ê –î–õ–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–û–í** üõ†Ô∏è",
        "",
        "‚öúÔ∏è **–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø:**",
        "`/admin` - –æ—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å",
        "",
        "üìä **–ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –û–¢–ß–ï–¢–´:**",
        "`/status` - —Å—Ç–∞—Ç—É—Å —Ç–µ–∫—É—â–∏—Ö —Å–º–µ–Ω",
        "`/rating` - —Ä–µ–π—Ç–∏–Ω–≥ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤", 
        "`/problems` - –ø–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–æ–Ω",
        "`/log` - –≤—ã–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥ —Å–º–µ–Ω—ã",
        "",
        "üé≠ **–£–ü–†–ê–í–õ–ï–ù–ò–ï –†–û–õ–Ø–ú–ò:**",
        "`/—Ä–æ–ª–∏` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ–ª–µ–π –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è",
        "`/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞_—Ä–æ–ª–µ–π` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–æ–ª—è–º",
        "",
        "‚öôÔ∏è **–£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ú–ï–ù–ê–ú–ò:**",
        "`/restart` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–º–µ–Ω—ã",
        "`/report` - –¥–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–º–µ–Ω—ã",
        "`/time [–º–∏–Ω—É—Ç—ã]` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º-–∞—É—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
        "",
        "ü§ñ **–£–ü–†–ê–í–õ–ï–ù–ò–ï –ë–û–¢–û–ú:**",
        "`/bot_status` - —Å—Ç–∞—Ç—É—Å —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞",
        "`/bot_off` –∏–ª–∏ `/–≤—ã–∫–ª—é—á–∏—Ç—å` - –≤—ã–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞",
        "`/bot_on` –∏–ª–∏ `/–≤–∫–ª—é—á–∏—Ç—å` - –≤–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞",
        "",
        "üîß **–ù–ê–°–¢–†–û–ô–ö–ò:**",
        "`/setup_wizard` - –º–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞",
        "`/ads` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏",
    ]
    
    if user_id == BOSS_ID:
        help_lines.extend([
            "",
            "üëë **–§–£–ù–ö–¶–ò–ò BOSS:**",
            "`/broadcast` - —Ä–∞—Å—Å—ã–ª–∫–∞ –≤–æ –≤—Å–µ —á–∞—Ç—ã",
            "`/global_stats` - –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
        ])
    
    help_lines.extend([
        "",
        "üí° **–ü–û–î–°–ö–ê–ó–ö–ê:**",
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/admin` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏!",
        "",
        "üì± **–ë–´–°–¢–†–´–ï –ö–û–ú–ê–ù–î–´:**",
        "`/helpadmin` - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É",
        "`/help` - —Å–ø—Ä–∞–≤–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
    ])
    
    return "\n".join(help_lines)

def get_roles_info_text() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–æ–ª—è—Ö –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏"""
    current_day_type = get_current_day_type()
    current_roles = get_roles_for_day_type(current_day_type)
    
    info_lines = [
        "üé≠ **–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –†–û–õ–Ø–•** üé≠",
        "",
        "üìÖ **–†–ê–°–ü–ò–°–ê–ù–ò–ï –†–ê–ë–û–¢–´:**",
        "",
        "üóìÔ∏è **–ë—É–¥–Ω–∏–µ –¥–Ω–∏ (–≤—Å-—á—Ç):**",
        f"   {ROLE_EMOJIS[UserRole.KARAOKE_HOST.value]} {ROLE_DESCRIPTIONS[UserRole.KARAOKE_HOST.value]} - 1 —á–µ–ª–æ–≤–µ–∫",
        "   üìä –¶–µ–ª—å: 15 –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π",
        "",
        "üéâ **–í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ (–ø—Ç-—Å–±):**",
        f"   {ROLE_EMOJIS[UserRole.KARAOKE_HOST.value]} {ROLE_DESCRIPTIONS[UserRole.KARAOKE_HOST.value]} - 1 —á–µ–ª–æ–≤–µ–∫",
        f"   {ROLE_EMOJIS[UserRole.MC.value]} {ROLE_DESCRIPTIONS[UserRole.MC.value]} - 1 —á–µ–ª–æ–≤–µ–∫",
        "   üìä –¶–µ–ª–∏: –ö–∞—Ä–∞–æ–∫–µ - 15, –ú–° - 10 –≥–æ–ª–æ—Å–æ–≤—ã—Ö",
        "",
        f"üïê **–°–ï–ì–û–î–ù–Ø ({current_day_type.value} –¥–µ–Ω—å):**",
    ]
    
    for role in current_roles:
        emoji = ROLE_EMOJIS.get(role, "üë§")
        description = ROLE_DESCRIPTIONS.get(role, role)
        info_lines.append(f"   ‚úÖ {emoji} {description}")
    
    info_lines.extend([
        "",
        "üéØ **–û–ü–ò–°–ê–ù–ò–ï –†–û–õ–ï–ô:**",
        "",
        f"{ROLE_EMOJIS[UserRole.KARAOKE_HOST.value]} **–ö–∞—Ä–∞–æ–∫–µ –≤–µ–¥—É—â–∏–π:**",
        "‚Ä¢ –í–µ–¥–µ—Ç –∫–∞—Ä–∞–æ–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—É",
        "‚Ä¢ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –≥–æ—Å—Ç—è–º–∏",
        "‚Ä¢ –û–±—ä—è–≤–ª—è–µ—Ç –ø–µ—Å–Ω–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä—É",
        "‚Ä¢ –†–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–ª–∞–º–Ω—ã–µ –±–ª–æ–∫–∏",
        "",
        f"{ROLE_EMOJIS[UserRole.MC.value]} **–í–µ–¥—É—â–∏–π-–∞–Ω–∏–º–∞—Ç–æ—Ä (–ú–°):**",
        "‚Ä¢ –ü—Ä–æ–≤–æ–¥–∏—Ç –∫–æ–Ω–∫—É—Ä—Å—ã –∏ –∏–≥—Ä—ã",
        "‚Ä¢ –†–∞–∑–≤–ª–µ–∫–∞–µ—Ç –ø—É–±–ª–∏–∫—É –º–µ–∂–¥—É –ø–µ—Å–Ω—è–º–∏",
        "‚Ä¢ –ü–æ–º–æ–≥–∞–µ—Ç –∫–∞—Ä–∞–æ–∫–µ –≤–µ–¥—É—â–µ–º—É",
        "‚Ä¢ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–ª–∞",
        "",
        "üìã **–ö–ê–ö –ó–ê–ù–Ø–¢–¨ –†–û–õ–¨:**",
        "`/start` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏",
        "`/start –∫–∞—Ä–∞–æ–∫–µ` - –∑–∞–Ω—è—Ç—å —Ä–æ–ª—å –∫–∞—Ä–∞–æ–∫–µ –≤–µ–¥—É—â–µ–≥–æ",
        "`/start –ú–°` - –∑–∞–Ω—è—Ç—å —Ä–æ–ª—å –ú–° (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)",
    ])
    
    return "\n".join(info_lines)

def register_help_handlers(bot):
    """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –ø–æ–º–æ—â–∏"""
    
    @bot.message_handler(commands=['help', '–ø–æ–º–æ—â—å'])
    def handle_help(message: types.Message):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
        help_text = get_user_help_text()
        bot.reply_to(message, help_text, parse_mode="Markdown")
    
    @bot.message_handler(commands=['helpadmin', '–∞–¥–º–∏–Ω–ø–æ–º–æ—â—å'])
    def handle_admin_help(message: types.Message):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /helpadmin"""
        user_id = message.from_user.id
        chat_id = message.chat.id
        
        if not is_admin(bot, user_id, chat_id):
            bot.reply_to(message, "‚ùå –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.")
            return
        
        help_text = get_admin_help_text(user_id)
        bot.reply_to(message, help_text, parse_mode="Markdown")
    
    @bot.message_handler(commands=['—Ä–æ–ª–∏', 'roles'])
    def handle_roles_info(message: types.Message):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /—Ä–æ–ª–∏"""
        info_text = get_roles_info_text()
        bot.reply_to(message, info_text, parse_mode="Markdown")
